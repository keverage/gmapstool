!function(t){"use strict";t.GmapsTool=function(e,s,n){return this.elements={gmapId:e},t.extend(!0,this.gmapOptions={},t.GmapsTool.defaults.gmapOptions,s),t.extend(!0,this.settings={},t.GmapsTool.defaults,n),delete this.settings.gmapOptions,this.gmap,this.markers=[],this.layers=[],this.pathAPI="https://maps.googleapis.com/maps/api",this.style=!1,this},t.GmapsTool.defaults={gmapOptions:{center:void 0,zoom:10,minZoom:7,maxZoom:17},apiKey:void 0,fullscreen:!1,type:"js",staticOptions:{scale:2,size:"300x300",maptype:"roadmap"},richMarkerOptions:{draggable:!1,shadow:"none"},cluster:!1,clusterOptions:{svg:{color:"#303748",colors:[],sizes:[36,46,56,66,76],textColor:"#fff",borderWidth:1,borderColor:"#fff"}}},t.GmapsTool.prototype={prepareOptions:function(){return 0===this.elements.gmapId.length?(this.setLog("error","Selector not found"),!1):void 0===this.gmapOptions.center?(this.setLog("error","Missing center parameter"),!1):(this.gmapOptions.center=this.getLatLng(this.gmapOptions.center),this.settings.fullscreen&&(this.gmapOptions.scrollwheel=!1),"staticmap"===this.settings.type&&void 0===this.settings.staticOptions.apiKey&&this.setLog("error",'Missing "apiKey" parameter'),!0)},init:function(){return this.prepareOptions()&&("staticmap"===this.settings.type?this.style===!1&&this.initStatic():this.gmap=new google.maps.Map(this.elements.gmapId[0],this.gmapOptions)),this},initStatic:function(){var e=this,s={};t.extend(!0,s,e.gmapOptions,e.settings.staticOptions),s.key=e.settings.apiKey,delete s.minZoom,delete s.maxZoom;var n=e.pathAPI+"/"+e.settings.type+"?",o=0;t.each(s,function(t,e){o>0&&(n+="&"),n+=t+"="+e,o++});var i=e.settings.staticOptions.size.split("x");return t("<img>",{src:n,width:i[0],height:i[1],alt:""}).appendTo(e.elements.gmapId),e},setOptions:function(e){return t.extend(!0,this.settings,e),this},setMapOptions:function(t){return this.getMap().setOptions(t),this},setMarkers:function(e,s){var n=this;return"staticmap"===n.settings.type&&e.length?(n.settings.staticOptions.markers="",t.each(e,function(t,e){n.settings.staticOptions.markers+=encodeURIComponent("icon:"+e.content)+"|"+e.position.join(",")})):(n.bounds=new google.maps.LatLngBounds,s=s||{},void 0===s.centerBounds&&(s.centerBounds=!0),n.prepareMarkersOptions(e)&&(e.length&&t.each(e,function(t,e){n.setMarker(e,s)}),s.centerBounds&&n.setCenter(),void 0!==s.cluster&&s.cluster===!0&&n.addMarkersClusters(s),void 0!==s.onComplete&&s.onComplete.call({GmapsTool:n,markers:n.getMarkers(),bounds:n.bounds}))),n},prepareMarkersOptions:function(t){return void 0===t?(this.setLog("error","Missing markers parameter"),!1):"undefined"==typeof RichMarker?(this.setLog("error",'Missing "RichMarker" dependency'),!1):!0},getMarkers:function(){return this.markers},addMarkersClusters:function(e){var s=this;if("undefined"==typeof MarkerClusterer)return s.setLog("error",'Missing "MarkerClusterer" dependency'),!1;var n={maxZoom:s.gmapOptions.maxZoom-1};s.settings.clusterOptions.svg!==!1&&Object.keys(s.settings.clusterOptions.svg).length&&Object.keys(s.settings.clusterOptions.svg.sizes).length&&(n.styles=[],t.each(s.settings.clusterOptions.svg.sizes,function(t,e){var o=s.settings.clusterOptions.svg.colors.length?s.settings.clusterOptions.svg.colors[t]:s.settings.clusterOptions.svg.color,i='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><circle cx="25" cy="25" r="25" stroke="'+s.settings.clusterOptions.svg.borderColor+'" stroke-width="'+s.settings.clusterOptions.svg.borderWidth+'" fill="'+o+'" /></svg>';n.styles.push({textColor:s.settings.clusterOptions.svg.textColor,url:"data:image/svg+xml;base64,"+window.btoa(i),width:e,height:e})})),t.extend(!0,s.settings.clusterOptions,n,e.clusterOptions);var o=[];return t.each(s.getMarkers(),function(t,e){o.push(e.richMarker)}),new MarkerClusterer(s.getMap(),o,s.settings.clusterOptions)},setMarker:function(e,s){var n=this;e.position=n.getLatLng(e.position),t.extend(e.richMarkerOptions={},n.settings.richMarkerOptions,{map:n.getMap(),content:"object"==typeof e.content?e.content[0]:e.content,position:e.position},e.options),e.richMarker=new RichMarker(e.richMarkerOptions);var o=["click","dblclick","mouseover","mouseout"];return t.each(o,function(t,o){var i=n.formatEventName(o);void 0!==s[i]&&google.maps.event.addListener(e.richMarker,o,function(){s[i].call({GmapsTool:n,marker:e,event:this})})}),n.bounds.extend(e.position),n.markers.push(e),void 0!==s.onAdd&&s.onAdd.call({GmapsTool:n,marker:e}),e},setCenter:function(){return void 0!==this.bounds?(this.getMarkers().length>1&&this.getMap().fitBounds(this.bounds),this.getMap().setCenter(this.bounds.getCenter())):this.getMap().setCenter(this.gmapOptions.center),this},setLayers:function(e,s){var n=this;return n.layers=[],void 0===s&&(s={}),void 0!==e&&e.length>0&&t.each(e,function(t,e){n.prepareLayerOptions(e)&&n.setLayer(e,s)}),void 0!==s.onComplete&&s.onComplete.call({GmapsTool:n,layers:n.getLayers()}),n},getLayers:function(){return this.layers},prepareLayerOptions:function(t){return void 0!==t.path&&"http"!==t.path.substring(0,4)?(this.setLog("error","The "+t.type+" file must be online"),!1):!0},setLayer:function(e,s){var n=this;t.extend(s,{url:e.path,preserveViewport:!0,map:n.getMap()}),e.layer=new google.maps.KmlLayer(s);var o=["click","defaultviewport_changed","status_changed"];return t.each(o,function(t,o){var i=n.formatEventName(o);void 0!==s[i]&&e.layer.addListener(o,function(){s[i].call({GmapsTool:n,layer:e,event:this})})}),n.layers.push(e),void 0!==s.onAdd&&s.onAdd.call({GmapsTool:n,layer:e}),e},setStyles:function(e){var s=this;return s.style=!0,t.getJSON(e).fail(function(){s.setLog("error","Json file not found")}).done(function(t){"staticmap"===s.settings.type?(s.settings.staticOptions.style=s.staticFormatStyles(t),s.initStatic()):s.getMap().set("styles",t)}),s},staticFormatStyles:function(t){var e=[],s="|",n=function(t){return/^#[0-9a-f]{6}$/i.test(t.toString())},o=function(t){return"0x"+t.slice(1)},i=0;for(e.length=0,i;i<t.length;i++){var r=t[i],a=r.hasOwnProperty("featureType"),p=r.hasOwnProperty("elementType"),l=r.stylers,c="",g="";a||p?(a&&(c="feature:"+r.featureType),p&&(c=c?c+s:"",c+="element:"+r.elementType)):c="feature:all";var u=0;for(u;u<l.length;u++){var h=l[u],m=Object.keys(h)[0];g=g?g+s:"",g+=m+":"+(n(h[m])?o(h[m]):h[m])}e.push(c+s+g)}return e.join("&style=")},setControls:function(e){var s=this;void 0===e&&(e={});var n={};if(t.extend(n,{mapTypeControl:!1,streetViewControl:!1,zoomControl:!1},e.mapOptions),this.setMapOptions(n),void 0!==e.zoom){var o=["in","out"];t.each(o,function(t,n){void 0!==e.zoom[n]&&e.zoom[n].length&&google.maps.event.addDomListener(e.zoom[n][0],"click",function(t){var o=s.getMap().getZoom();s.getMap().setZoom("in"===n?++o:--o),void 0!==e.zoom.onClick&&e.zoom.onClick.call({GmapsTool:s,zoom:{type:n,level:o},event:t})})})}return s},setLog:function(t,e){console[t]("GmapsTool: "+e)},getLatLng:function(t){return"string"==typeof t&&-1!==t.indexOf(",")&&(t=t.split(",")),"object"==typeof t&&2===t.length?"staticmap"===this.settings.type?t[0]+","+t[1]:new google.maps.LatLng(t[0],t[1]):!1},getMap:function(){return this.gmap},formatEventName:function(t){return"on"+t.substr(0,1).toUpperCase()+t.substr(1)}},t.fn.gmapsTool=function(e,s){return new t.GmapsTool(t(this),e,s)}}(jQuery);