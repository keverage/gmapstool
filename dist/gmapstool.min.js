!function(r){"use strict";r.GmapsTool=function(t,e){return this.elements={container:t},r.extend(!0,this.settings={},r.GmapsTool.defaults,e),this.center=void 0,this.gmap=void 0,this.markers=[],this.markersOptions={},this.infoWindow=void 0,this.layers=[],this.pathAPI="https://maps.googleapis.com/maps/api",this.style=!1,this.directionsDisplay=void 0,this.directionsService=void 0,this.distanceService=void 0,this},r.GmapsTool.defaults={map:{center:void 0,zoom:10,minZoom:7,maxZoom:17},apiKey:void 0,fullscreen:!1,type:"js",staticOptions:{size:"300x300",scale:2,maptype:"roadmap"},markersOptions:{centerBounds:!0,cluster:!1,clusterOptions:{svg:{color:"#303748",colors:[],sizes:[36,46,56,66,76],textColor:"#fff",borderWidth:1,borderColor:"#fff"}},infoWindowOptions:{pixelOffset:[0,-30]},richMarkerOptions:{draggable:!1,shadow:"none"}},routeOptions:{origin:void 0,destination:void 0,travelMode:"DRIVING",displayOptions:{polylineOptions:{strokeColor:"#303748",strokeWeight:4},suppressInfoWindows:!0,suppressMarkers:!0}}},r.GmapsTool.prototype={prepareOptions:function(){return 0===this.elements.container.length?(this.setLog("error","Selector not found"),!1):void 0===this.settings.map.center?(this.setLog("error","Missing center parameter"),!1):(this.center=this.settings.map.center,this.settings.map.center=this.getLatLng(),this.settings.fullscreen&&(this.settings.map.scrollwheel=!1),"staticmap"!==this.settings.type||void 0!==this.settings.apiKey&&""!==this.settings.apiKey||(this.setLog("error",'Missing "apiKey" parameter'),!1))},init:function(){return this.prepareOptions()&&("staticmap"===this.settings.type?!1===this.style&&this.initStatic():this.gmap=new google.maps.Map(this.elements.container[0],this.settings.map)),this},setStatic:function(t){return this.settings.type="staticmap",r.extend(!0,this.settings.staticOptions,t),this},initStatic:function(){var e=this,t={};r.extend(!0,t,e.settings.map,e.settings.staticOptions),t.key=e.settings.apiKey,delete t.minZoom,delete t.maxZoom;var s=e.pathAPI+"/"+e.settings.type+"?",n=0;return r.each(t,function(t,e){0<n&&(s+="&"),s+=t+"="+e,n++}),r.ajax(s).done(function(){var t=e.settings.staticOptions.size.split("x");r("<img>",{src:s,width:t[0],height:t[1],alt:""}).appendTo(e.elements.container)}).fail(function(t){e.setLog("error",t.responseText)}),e},setOptions:function(t){return r.extend(!0,this.settings,t),this},setMapOptions:function(t){return this.getMap().setOptions(t),this},setMarkers:function(t,e){var s=this;return"staticmap"===s.settings.type&&t.length?(s.settings.staticOptions.markers="",r.each(t,function(t,e){"string"!=typeof e.content||"string"==typeof e.content&&-1===e.content.indexOf("http")?s.setLog("error","Marker content must be online and must be an PNG image (64x64). E.g: http://site.com/image.png"):s.settings.staticOptions.markers+="icon:"+encodeURIComponent(e.content)+"|"+("array"==typeof e.position?e.position.join(","):e.position)})):(s.bounds=new google.maps.LatLngBounds,s.prepareMarkersOptions(t,e)&&(t.length&&r.each(t,function(t,e){s.setMarker(e)}),s.settings.markersOptions.centerBounds&&s.setCenter(),s.settings.markersOptions.cluster&&s.addMarkersClusters(),void 0!==s.settings.markersOptions.onComplete&&s.settings.markersOptions.onComplete.call({gmapsTool:s,markers:s.getMarkers(),bounds:s.bounds}))),s},prepareMarkersOptions:function(t,e){if(void 0===t)return this.setLog("error","Missing markers parameter"),!1;if(r.extend(!0,this.settings.markersOptions,e),"undefined"==typeof RichMarker)return this.setLog("error",'Missing "RichMarker" dependency'),!1;var s=!1;return r.each(t,function(t,e){e.hasOwnProperty("infoWindow")&&(s=!0)}),s&&(this.settings.markersOptions.infoWindowOptions.pixelOffset=new google.maps.Size(this.settings.markersOptions.infoWindowOptions.pixelOffset[0],this.settings.markersOptions.infoWindowOptions.pixelOffset[1]),this.infoWindow=new google.maps.InfoWindow(this.settings.markersOptions.infoWindowOptions)),!0},getMarkers:function(){return this.markers},addMarkersClusters:function(){var o=this;if("undefined"==typeof MarkerClusterer)return o.setLog("error",'Missing "MarkerClusterer" dependency'),!1;var i={maxZoom:o.settings.map.maxZoom-1};!1!==o.settings.markersOptions.clusterOptions.svg&&Object.keys(o.settings.markersOptions.clusterOptions.svg).length&&Object.keys(o.settings.markersOptions.clusterOptions.svg.sizes).length&&(i.styles=[],r.each(o.settings.markersOptions.clusterOptions.svg.sizes,function(t,e){var s=o.settings.markersOptions.clusterOptions.svg.colors.length?o.settings.markersOptions.clusterOptions.svg.colors[t]:o.settings.markersOptions.clusterOptions.svg.color,n='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><circle cx="25" cy="25" r="25" stroke="'+o.settings.markersOptions.clusterOptions.svg.borderColor+'" stroke-width="'+o.settings.markersOptions.clusterOptions.svg.borderWidth+'" fill="'+s+'" /></svg>';i.styles.push({textColor:o.settings.markersOptions.clusterOptions.svg.textColor,url:"data:image/svg+xml;base64,"+window.btoa(n),width:e,height:e})})),r.extend(!0,o.settings.markersOptions.clusterOptions,i,o.settings.markersOptions.clusterOptions);var s=[];return r.each(o.getMarkers(),function(t,e){s.push(e.richMarker)}),new MarkerClusterer(o.getMap(),s,o.settings.markersOptions.clusterOptions)},setMarker:function(n){var o=this;return n.position=o.getLatLng(n.position),r.extend(!0,n.richMarkerOptions={},o.settings.markersOptions.richMarkerOptions,{map:o.getMap(),content:"object"==typeof n.content?n.content[0]:n.content,position:n.position}),n.richMarker=new RichMarker(n.richMarkerOptions),n.hasOwnProperty("infoWindow")&&!o.settings.markersOptions.hasOwnProperty("onClick")&&(o.settings.markersOptions.onClick=function(){o.openInfoWindow(this)}),r.each(["click","dblclick","mouseover","mouseout"],function(t,e){var s=o.formatEventName(e);void 0!==o.settings.markersOptions[s]&&google.maps.event.addListener(n.richMarker,e,function(){o.settings.markersOptions[s].call({gmapsTool:o,marker:n,event:this})})}),o.bounds.extend(n.position),o.markers.push(n),void 0!==o.settings.markersOptions.onAdd&&o.settings.markersOptions.onAdd.call({gmapsTool:o,marker:n}),n},openInfoWindow:function(t){var e=t.gmapsTool||this;return e.closeInfoWindow(),t.marker.infoWindow.length&&(e.getInfoWindow().setContent("object"==typeof t.marker.infoWindow?t.marker.infoWindow[0].outerHTML:t.marker.infoWindow),e.getInfoWindow().setPosition(t.marker.position),e.getInfoWindow().open(e.getMap()),(e.getInfoWindow().gmapsTool=e).getInfoWindow().elements={infowindow:r(e.getMap().getDiv()).find(".gm-style-iw")},e.getInfoWindow().elements.infowindow.length&&(e.getInfoWindow().elements.wrapper=e.getInfoWindow().elements.infowindow.parent(),e.getInfoWindow().elements.wrapper.length&&e.getInfoWindow().elements.wrapper.addClass("gm-style-iw-wrapper"),e.getInfoWindow().elements.background=e.getInfoWindow().elements.infowindow.prev(),e.getInfoWindow().elements.background.length&&e.getInfoWindow().elements.background.addClass("gm-style-iw-background"),e.getInfoWindow().elements.close=e.getInfoWindow().elements.infowindow.next(),e.getInfoWindow().elements.close.length&&e.getInfoWindow().elements.close.addClass("gm-style-iw-close")),t.marker.content.addClass("is-open"),google.maps.event.addListener(e.getInfoWindow(),"closeclick",e.closeInfoWindow),void 0!==e.settings.markersOptions.onInfoWindowOpen&&e.settings.markersOptions.onInfoWindowOpen.call({gmapsTool:e,event:t.event,marker:t.marker,infoWindow:e.getInfoWindow()})),e},closeInfoWindow:function(){var t=this.gmapsTool||this;return t.markers.length&&r.each(t.markers,function(){this.content.removeClass("is-open")}),void 0!==t.settings.markersOptions.onInfoWindowClose&&t.settings.markersOptions.onInfoWindowClose.call({gmapsTool:t,infoWindow:t.getInfoWindow()}),t},getInfoWindow:function(){return this.infoWindow},setCenter:function(){return void 0!==this.bounds?(1<this.getMarkers().length&&this.getMap().fitBounds(this.bounds),this.getMap().setCenter(this.bounds.getCenter())):this.getMap().setCenter(this.getCenter(!0)),this},getCenter:function(t){return(t=t||!1)?this.settings.map.center:this.center},setLayers:function(t,s){var n=this;return n.layers=[],void 0===s&&(s={}),void 0!==t&&0<t.length&&r.each(t,function(t,e){n.prepareLayerOptions(e)&&n.setLayer(e,s)}),void 0!==s.onComplete&&s.onComplete.call({gmapsTool:n,layers:n.getLayers()}),n},getLayers:function(){return this.layers},prepareLayerOptions:function(t){return void 0===t.path||"http"===t.path.substring(0,4)||(this.setLog("error","The "+t.type+" file must be online"),!1)},setLayer:function(n,o){var i=this;return r.extend(o,{url:n.path,preserveViewport:!0,map:i.getMap()}),n.layer=new google.maps.KmlLayer(o),r.each(["click","dblclick","mouseover","mouseout"],function(t,e){var s=i.formatEventName(e);void 0!==o[s]&&n.layer.addListener(e,function(){o[s].call({gmapsTool:i,layer:n,event:this})})}),i.layers.push(n),void 0!==o.onAdd&&o.onAdd.call({gmapsTool:i,layer:n}),n},setStyles:function(t){var e=this;return e.style=!0,r.getJSON(t).fail(function(){e.setLog("error","Json file not found.")}).done(function(t){"staticmap"===e.settings.type?(e.settings.staticOptions.style=e.staticFormatStyles(t),e.initStatic()):e.getMap().set("styles",t)}),e},staticFormatStyles:function(t){var e,s=[],n=0;for(s.length=0;n<t.length;n++){var o=t[n],i=o.hasOwnProperty("featureType"),r=o.hasOwnProperty("elementType"),a=o.stylers,p="",g="";i||r?(i&&(p="feature:"+o.featureType),r&&(p=p?p+"|":"",p+="element:"+o.elementType)):p="feature:all";for(var l=0;l<a.length;l++){var c=a[l],d=Object.keys(c)[0];g=g?g+"|":"",g+=d+":"+(e=c[d],/^#[0-9a-f]{6}$/i.test(e.toString())?"0x"+c[d].slice(1):c[d])}s.push(p+"|"+g)}return s.join("&style=")},setControls:function(n){var o=this;void 0===n&&(n={});var t={};if(r.extend(t,{mapTypeControl:!1,streetViewControl:!1,zoomControl:!1},n.mapOptions),this.setMapOptions(t),void 0!==n.zoom){r.each(["in","out"],function(t,s){void 0!==n.zoom[s]&&n.zoom[s].length&&google.maps.event.addDomListener(n.zoom[s][0],"click",function(t){var e=o.getMap().getZoom();o.getMap().setZoom("in"===s?++e:--e),void 0!==n.zoom.onClick&&n.zoom.onClick.call({gmapsTool:o,zoom:{type:s,level:e},event:t})})})}return o},setRoute:function(t){return r.extend(!0,this.settings.routeOptions,t),this.directionsDisplay=new google.maps.DirectionsRenderer(this.settings.routeOptions.displayOptions),this.directionsDisplay.setMap(this.getMap()),this},routePrepareOptions:function(){return void 0===this.settings.routeOptions.origin?(this.setLog("error",'Missing option "origin".'),!1):void 0!==this.settings.routeOptions.destination||(this.setLog("error",'Missing option "destination".'),!1)},setTrace:function(){var s=this;return s.routePrepareOptions()&&(void 0===s.directionsService&&(s.directionsService=new google.maps.DirectionsService),s.directionsService.route({origin:s.settings.routeOptions.origin,destination:s.settings.routeOptions.destination,travelMode:google.maps.TravelMode[s.settings.routeOptions.travelMode]},function(t,e){e===google.maps.DirectionsStatus.OK&&s.directionsDisplay.setDirections(t)})),s},getDistance:function(n){var o=this;return o.routePrepareOptions()&&(void 0===o.distanceService&&(o.distanceService=new google.maps.DistanceMatrixService),o.distanceService.getDistanceMatrix({origins:[o.settings.routeOptions.origin],destinations:[o.settings.routeOptions.destination],travelMode:google.maps.TravelMode[o.settings.routeOptions.travelMode]},function(t,e){if("OK"===e){var s={gmapsTool:o,result:t};void 0!==t.rows[0]&&void 0!==t.rows[0].elements[0]&&(s.distance=t.rows[0].elements[0].distance,s.duration=t.rows[0].elements[0].duration),n.call(s)}})),o},setLog:function(t,e){console[t]("GmapsTool: "+e)},getLatLng:function(t){return"string"==typeof(t=t||this.getCenter())&&-1!==t.indexOf(",")&&(t=t.split(",")),"object"==typeof t&&2===t.length&&("staticmap"===this.settings.type?t[0]+","+t[1]:new google.maps.LatLng(t[0],t[1]))},getMap:function(){return this.gmap},formatEventName:function(t){return"on"+t.substr(0,1).toUpperCase()+t.substr(1)}},r.fn.gmapsTool=function(t){return new r.GmapsTool(r(this),t)}}(jQuery);