!function(t){"use strict";t.GmapsTool=function(e,s,o){return this.elements={gmapId:e},t.extend(!0,this.gmapOptions={},t.GmapsTool.defaults.gmapOptions,s),t.extend(!0,this.settings={},t.GmapsTool.defaults,o),delete this.settings.gmapOptions,this.markers=[],this.layers=[],this},t.GmapsTool.defaults={gmapOptions:{center:void 0,zoom:10,minZoom:7,maxZoom:17},fullscreen:!1,richMarkerOptions:{draggable:!1,shadow:"none"},cluster:!1,clusterOptions:{svg:{color:"#303748",colors:[],sizes:[36,46,56,66,76],textColor:"#fff",borderWidth:1,borderColor:"#fff"}}},t.GmapsTool.prototype={prepareOptions:function(){return 0===this.elements.gmapId.length?(this.setLog("error","Selector not found"),!1):void 0===this.gmapOptions.center?(this.setLog("error","Missing center parameter"),!1):(this.gmapOptions.center=this.getLatLng(this.gmapOptions.center),this.settings.fullscreen&&(this.gmapOptions.scrollwheel=!1),!0)},init:function(){return this.prepareOptions()&&(this.gmap=new google.maps.Map(this.elements.gmapId[0],this.gmapOptions)),this},setMapOptions:function(t){return this.getMap().setOptions(t),this},setMarkers:function(e,s){var o=this;return o.bounds=new google.maps.LatLngBounds,void 0===(s=s||{}).centerBounds&&(s.centerBounds=!0),o.prepareMarkersOptions(e)&&(e.length&&t.each(e,function(t,e){o.setMarker(e,s)}),s.centerBounds&&o.setCenter(),void 0!==s.cluster&&!0===s.cluster&&o.addMarkersClusters(s),void 0!==s.onComplete&&s.onComplete.call({GmapsTool:o,markers:o.getMarkers(),bounds:o.bounds})),o},prepareMarkersOptions:function(t){return void 0===t?(this.setLog("error","Missing markers parameter"),!1):"undefined"!=typeof RichMarker||(this.setLog("error",'Missing "RichMarker" dependency'),!1)},getMarkers:function(){return this.markers},addMarkersClusters:function(e){var s=this;if("undefined"==typeof MarkerClusterer)return s.setLog("error",'Missing "MarkerClusterer" dependency'),!1;var o={maxZoom:s.gmapOptions.maxZoom-1};!1!==s.settings.clusterOptions.svg&&Object.keys(s.settings.clusterOptions.svg).length&&Object.keys(s.settings.clusterOptions.svg.sizes).length&&(o.styles=[],t.each(s.settings.clusterOptions.svg.sizes,function(t,e){var n=s.settings.clusterOptions.svg.colors.length?s.settings.clusterOptions.svg.colors[t]:s.settings.clusterOptions.svg.color,r='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50"><circle cx="25" cy="25" r="25" stroke="'+s.settings.clusterOptions.svg.borderColor+'" stroke-width="'+s.settings.clusterOptions.svg.borderWidth+'" fill="'+n+'" /></svg>';o.styles.push({textColor:s.settings.clusterOptions.svg.textColor,url:"data:image/svg+xml;base64,"+window.btoa(r),width:e,height:e})})),t.extend(!0,s.settings.clusterOptions,o,e.clusterOptions);var n=[];return t.each(s.getMarkers(),function(t,e){n.push(e.richMarker)}),new MarkerClusterer(s.getMap(),n,s.settings.clusterOptions)},setMarker:function(e,s){var o=this;e.position=o.getLatLng(e.position),t.extend(e.richMarkerOptions={},o.settings.richMarkerOptions,{map:o.getMap(),content:"object"==typeof e.content?e.content[0]:e.content,position:e.position},e.options),e.richMarker=new RichMarker(e.richMarkerOptions);var n=["click","dblclick","mouseover","mouseout"];return t.each(n,function(t,n){var r=o.formatEventName(n);void 0!==s[r]&&google.maps.event.addListener(e.richMarker,n,function(){s[r].call({GmapsTool:o,marker:e,event:this})})}),o.bounds.extend(e.position),o.markers.push(e),void 0!==s.onAdd&&s.onAdd.call({GmapsTool:o,marker:e}),e},setCenter:function(){return void 0!==this.bounds?(this.getMarkers().length>1&&this.getMap().fitBounds(this.bounds),this.getMap().setCenter(this.bounds.getCenter())):this.getMap().setCenter(this.gmapOptions.center),this},setLayers:function(e,s){var o=this;return o.layers=[],void 0===s&&(s={}),void 0!==e&&e.length>0&&t.each(e,function(t,e){o.prepareLayerOptions(e)&&o.setLayer(e,s)}),void 0!==s.onComplete&&s.onComplete.call({GmapsTool:o,layers:o.getLayers()}),o},getLayers:function(){return this.layers},prepareLayerOptions:function(t){return void 0===t.path||"http"===t.path.substring(0,4)||(this.setLog("error","The "+t.type+" file must be online"),!1)},setLayer:function(e,s){var o=this;t.extend(s,{url:e.path,preserveViewport:!0,map:o.getMap()}),e.layer=new google.maps.KmlLayer(s);var n=["click","defaultviewport_changed","status_changed"];return t.each(n,function(t,n){var r=o.formatEventName(n);void 0!==s[r]&&e.layer.addListener(n,function(){s[r].call({GmapsTool:o,layer:e,event:this})})}),o.layers.push(e),void 0!==s.onAdd&&s.onAdd.call({GmapsTool:o,layer:e}),e},setStyles:function(e){var s=this;return t.getJSON(e).fail(function(){s.setLog("error","Json file not found")}).done(function(t){s.getMap().set("styles",t)}),s},setControls:function(e){var s=this;void 0===e&&(e={});var o={};if(t.extend(o,{mapTypeControl:!1,streetViewControl:!1,zoomControl:!1},e.mapOptions),this.setMapOptions(o),void 0!==e.zoom){var n=["in","out"];t.each(n,function(t,o){void 0!==e.zoom[o]&&e.zoom[o].length&&google.maps.event.addDomListener(e.zoom[o][0],"click",function(t){var n=s.getMap().getZoom();s.getMap().setZoom("in"===o?++n:--n),void 0!==e.zoom.onClick&&e.zoom.onClick.call({GmapsTool:s,zoom:{type:o,level:n},event:t})})})}return s},setLog:function(t,e){console[t]("GmapsTool: "+e)},getLatLng:function(t){return"string"==typeof t&&-1!==t.indexOf(",")&&(t=t.split(",")),"object"==typeof t&&2===t.length&&new google.maps.LatLng(t[0],t[1])},getMap:function(){return this.gmap},formatEventName:function(t){return"on"+t.substr(0,1).toUpperCase()+t.substr(1)}},t.fn.gmapsTool=function(e,s){return new t.GmapsTool(t(this),e,s)}}(jQuery);