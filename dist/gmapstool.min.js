!function(e){"use strict";e.GmapsTool=function(t,o,n){return this.elements={gmapId:t},e.extend(this.gmapOptions={},e.GmapsTool.defaults.gmapOptions,o),e.extend(this.settings={},e.GmapsTool.defaults,n),delete this.settings.gmapOptions,this.markers=[],this.layers=[],this},e.GmapsTool.defaults={gmapOptions:{center:void 0,zoom:10,minZoom:7,maxZoom:17},richMarkerOptions:{draggable:!1,shadow:"none"},fullscreen:!1},e.GmapsTool.prototype={prepareGmapOptions:function(){return void 0===this.gmapOptions.center?(this.setLog("error",'Please set "center" options'),!1):(this.gmapOptions.center=this.getLatLng(this.gmapOptions.center),this.settings.fullscreen&&(this.gmapOptions.scrollwheel=!1),!0)},init:function(){return this.prepareGmapOptions()&&(this.gmap=new google.maps.Map(this.elements.gmapId[0],this.gmapOptions)),this},setMapOptions:function(e){return this.gmap.setOptions(e),this},setMarkers:function(t,o){var n=this;return n.bounds=new google.maps.LatLngBounds,void 0===t?(n.setLog("error","Missing markers parameter"),!1):(void 0===o&&(o={}),"undefined"==typeof RichMarker?(n.setLog("error",'Missing "RichMarker" dependency'),!1):(t.length&&e.each(t,function(e,t){n.setMarker(t,o)}),n.setCenter(),void 0!==o.cluster&&o.cluster===!0&&n.addMarkersClusters(o),void 0!==o.onComplete&&o.onComplete.call({GmapsTool:n,markers:n.getMarkers(),bounds:n.bounds}),n))},getMarkers:function(){return this.markers},addMarkersClusters:function(t){if("undefined"==typeof MarkerClusterer)return this.setLog("error",'Missing "MarkerClusterer" dependency'),!1;e.extend({maxZoom:this.gmapOptions.maxZoom},t.clusterOptions=void 0===t.clusterOptions?{}:t.clusterOptions);var o=[];return e.each(this.getMarkers(),function(e,t){o.push(t.richMarker)}),new MarkerClusterer(this.gmap,o,t.clusterOptions)},setMarker:function(t,o){var n=this;t.position=n.getLatLng(t.position),e.extend(t.richMarkerOptions={},n.settings.richMarkerOptions,{map:n.gmap,content:"object"==typeof t.content?t.content[0]:t.content,position:t.position},t.options),t.richMarker=new RichMarker(t.richMarkerOptions);var s=["click","dblclick","mouseover","mouseout"];return e.each(s,function(e,s){var r=n.formatEventName(s);void 0!==o[r]&&google.maps.event.addListener(t.richMarker,s,function(){o[r].call({GmapsTool:n,marker:t,event:this})})}),n.bounds.extend(t.position),n.markers.push(t),void 0!==o.onAdd&&o.onAdd.call({GmapsTool:n,marker:t}),t},setCenter:function(){return void 0!==this.bounds?(this.getMarkers().length>1&&this.gmap.fitBounds(this.bounds),this.gmap.setCenter(this.bounds.getCenter())):this.gmap.setCenter(this.gmapOptions.center),this},setLayers:function(t,o){var n=this;return n.layers=[],void 0===o&&(o={}),void 0!==t&&t.length>0&&e.each(t,function(e,t){n.prepareLayerOptions(t)&&n.setLayer(t,o)}),void 0!==o.onComplete&&o.onComplete.call({GmapsTool:n,layers:n.getLayers()}),n},getLayers:function(){return this.layers},prepareLayerOptions:function(e){return void 0===e.path||"http"===e.path.substring(0,4)||(this.setLog("error","The "+e.type+" file must be online"),!1)},setLayer:function(t,o){var n=this;e.extend(o,{url:t.path,preserveViewport:!0,map:n.gmap}),t.layer=new google.maps.KmlLayer(o);var s=["click","defaultviewport_changed","status_changed"];return e.each(s,function(e,s){var r=n.formatEventName(s);void 0!==o[r]&&t.layer.addListener(s,function(){o[r].call({GmapsTool:n,layer:t,event:this})})}),n.layers.push(t),void 0!==o.onAdd&&o.onAdd.call({GmapsTool:n,layer:t}),t},setStyles:function(t){var o=this;return e.getJSON(t).fail(function(){o.setLog("error","Json file not found")}).done(function(e){o.gmap.set("styles",e)}),o},setControls:function(t){var o=this;void 0===t&&(t={});var n={};if(e.extend(n,{mapTypeControl:!1,streetViewControl:!1,zoomControl:!1},t.mapOptions),this.setMapOptions(n),void 0!==t.zoom){var s=["in","out"];e.each(s,function(e,n){void 0!==t.zoom[n]&&t.zoom[n].length&&google.maps.event.addDomListener(t.zoom[n][0],"click",function(e){var s=o.gmap.getZoom();o.gmap.setZoom("in"===n?++s:--s),void 0!==t.zoom.onClick&&t.zoom.onClick.call({GmapsTool:o,zoom:{type:n,level:s},event:e})})})}return o},setLog:function(e,t){console[e]("GmapsTool: "+t)},getLatLng:function(e){return"string"==typeof e&&e.indexOf(",")!==-1&&(e=e.split(",")),"object"==typeof e&&2===e.length&&new google.maps.LatLng(e[0],e[1])},formatEventName:function(e){return"on"+e.substr(0,1).toUpperCase()+e.substr(1)}},e.fn.gmapsTool=function(t,o){return new e.GmapsTool(e(this),t,o)}}(jQuery);